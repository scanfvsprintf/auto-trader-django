# 相关性分析功能说明

## 功能概述

相关性分析功能允许用户比较两个金融标的（股票或基金）之间的价格走势相关性，通过计算移动相关系数来分析它们之间的关系强度和变化趋势。

## 功能特性

### 1. 标的比较
- 支持股票和ETF的比较分析
- 智能搜索功能，支持代码、名称和拼音首字母搜索
- 自动识别标的类型（股票/基金）

### 2. 移动相关系数计算
- 基于Pearson相关系数算法
- 支持自定义移动窗口大小（30、60、90、120、252天）
- 使用日收益率计算相关性，更准确地反映价格关系

### 3. 可视化分析
- 使用ECharts生成交互式相关系数趋势图
- 包含参考线（0线、±0.5线）
- 支持数据缩放、悬停提示等交互功能
- 支持中文显示，完美适配移动端和桌面端

### 4. 统计分析
- 当前相关性系数
- 平均相关性系数
- 最大/最小相关性系数
- 相关性波动标准差

## 技术实现

### 后端API

#### 端点
```
POST /webManager/analysis/correlation/compare
```

#### 请求参数
```json
{
  "symbol1": "sh.600519",     // 第一个标的代码
  "symbol2": "sz.000001",     // 第二个标的代码
  "window_size": 60,          // 移动窗口大小（天）
  "start_date": "2023-01-01", // 开始日期（可选）
  "end_date": "2024-01-01"    // 结束日期（可选）
}
```

#### 响应数据
```json
{
  "code": 0,
  "msg": "ok",
  "data": {
    "symbol1": {
      "code": "sh.600519",
      "name": "贵州茅台",
      "type": "stock"
    },
    "symbol2": {
      "code": "sz.000001", 
      "name": "平安银行",
      "type": "stock"
    },
    "analysis_period": {
      "start_date": "2023-01-01",
      "end_date": "2024-01-01",
      "window_size": 60,
      "total_points": 200
    },
    "statistics": {
      "current_correlation": 0.3245,
      "average_correlation": 0.2876,
      "max_correlation": 0.6789,
      "min_correlation": -0.1234,
      "correlation_std": 0.1567
    },
    "chart_data": [
      ["2023-01-01", 0.1234],
      ["2023-01-02", 0.2345],
      ...
    ],
    "chart_config": {
      "title": "贵州茅台 vs 平安银行",
      "subtitle": "移动相关系数 (窗口大小: 60天)",
      "yAxis_min": -1.1,
      "yAxis_max": 1.1
    }
  }
}
```

### 前端界面

#### 菜单结构
```
指标分析
├── 相关性分析
    └── 标的比较选项卡
```

#### 界面特性
- **桌面端**: 左侧设置面板 + 右侧结果展示
- **移动端**: 响应式布局，抽屉式设置面板
- **横屏/竖屏**: 自动适配不同屏幕方向

#### 主要组件
1. **标的选择器**: 支持远程搜索的下拉选择框
2. **参数设置**: 窗口大小、时间区间配置
3. **统计面板**: 关键指标展示
4. **ECharts图表**: 交互式相关性趋势图，支持缩放、悬停提示等

## 使用指南

### 1. 访问功能
1. 登录系统后，点击左侧菜单"指标分析"
2. 选择"相关性分析"子菜单
3. 进入标的比较分析页面

### 2. 选择标的
1. 在"第一个标的"下拉框中搜索并选择标的
2. 在"第二个标的"下拉框中搜索并选择标的
3. 支持输入代码、名称或拼音首字母进行搜索

### 3. 设置参数
1. 选择移动窗口大小（推荐60天）
2. 设置分析时间区间（默认最近一年）
3. 点击"开始分析"按钮

### 4. 查看结果
1. 统计面板显示关键指标
2. ECharts图表展示相关性变化趋势
3. 支持鼠标悬停查看具体数值
4. 支持滚轮缩放和拖拽查看不同时间段
5. 图表包含参考线帮助理解相关性强度

## 相关性解读

### 相关系数范围
- **1.0**: 完全正相关
- **0.5-1.0**: 强正相关
- **0.0-0.5**: 弱正相关
- **0.0**: 无相关性
- **-0.5-0.0**: 弱负相关
- **-1.0--0.5**: 强负相关
- **-1.0**: 完全负相关

### 实际应用
- **投资组合**: 选择低相关性的资产分散风险
- **对冲策略**: 寻找负相关资产进行对冲
- **市场分析**: 了解不同资产间的联动关系
- **风险控制**: 监控资产相关性变化

## 扩展性设计

### 预留接口
系统已预留扩展接口，未来可轻松添加：
- 风险分析选项卡
- 其他相关性算法（Spearman、Kendall等）
- 多标的比较分析
- 行业相关性分析

### 技术架构
- **模块化设计**: 前后端分离，易于维护
- **响应式布局**: 支持各种设备尺寸
- **可扩展性**: 基于Vue.js和Django的灵活架构

## 测试验证

### 测试脚本
运行 `test_correlation_api.py` 脚本可以测试API功能：

```bash
python test_correlation_api.py
```

### 测试用例
1. 股票vs股票比较
2. 基金vs基金比较  
3. 股票vs基金比较
4. 不同时间窗口测试
5. 边界条件测试

## 注意事项

1. **数据完整性**: 确保选择的标的有足够的历史数据
2. **时间对齐**: 系统自动处理交易日对齐问题
3. **计算精度**: 使用后复权价格确保计算准确性
4. **性能考虑**: 大量数据计算可能需要较长时间

## 更新日志

### v1.1.0 (2024-01-XX)
- ✅ 升级为ECharts交互式图表
- ✅ 支持数据缩放和悬停提示
- ✅ 优化图表性能和用户体验
- ✅ 移除matplotlib依赖，提升响应速度

### v1.0.0 (2024-01-XX)
- ✅ 实现基础相关性分析功能
- ✅ 支持股票和ETF比较
- ✅ 移动端响应式布局
- ✅ 完整的统计分析
